 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - EduPay</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">EduPay Admin</div>
      <nav>
        <a href="#" class="nav-item active" data-tab="overview">
          <span>üìä</span> Overview
        </a>
        <a href="#" class="nav-item" data-tab="payments">
          <span>üí∞</span> All Payments
        </a>
        <a href="#" class="nav-item" data-tab="students">
          <span>üë•</span> Manage Students
        </a>
        <a href="#" class="nav-item" data-tab="receipt-config">
          <span>üé®</span> Receipt Design
        </a>
        <a href="#" class="nav-item" data-tab="reports">
          <span>üìà</span> Reports
        </a>
        <a href="#" class="nav-item" data-tab="settings">
          <span>‚öôÔ∏è</span> Settings
        </a>
        <a href="#" class="nav-item logout">
          <span>üö™</span> Logout
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="dashboard-header">
        <h2 id="pageTitle">Dashboard Overview</h2>
        <div class="user-info">
          <span id="userName">Loading...</span>
        </div>
      </header>

      <!-- Overview Tab -->
      <section id="tab-overview" class="tab-content active">
        <!-- Statistics Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" style="background: #DBEAFE;">üí∞</div>
            <div class="stat-content">
              <p class="stat-label">Total Revenue</p>
              <h3 class="stat-value" id="totalRevenue">KES 0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #D1FAE5;">‚úÖ</div>
            <div class="stat-content">
              <p class="stat-label">Completed Payments</p>
              <h3 class="stat-value" id="completedPayments">0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #FEF3C7;">‚è≥</div>
            <div class="stat-content">
              <p class="stat-label">Pending Payments</p>
              <h3 class="stat-value" id="pendingPayments">0</h3>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background: #E0E7FF;">üë•</div>
            <div class="stat-content">
              <p class="stat-label">Total Students</p>
              <h3 class="stat-value" id="totalStudents">0</h3>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
          <div class="card">
            <h3>Payments by Class</h3>
            <canvas id="paymentsByClassChart"></canvas>
          </div>
          <div class="card">
            <h3>Payment Trends (Last 7 Days)</h3>
            <canvas id="paymentTrendsChart"></canvas>
          </div>
        </div>

        <!-- Recent Payments -->
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3>Recent Payments</h3>
            <button onclick="refreshPayments()" class="btn btn-sm">üîÑ Refresh</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Student</th>
                  <th>Class</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="recentPaymentsBody">
                <tr><td colspan="6" class="text-center">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- All Payments Tab -->
      <section id="tab-payments" class="tab-content">
        <div class="card">
          <h3>All Payments</h3>
          
          <!-- Filters -->
          <div class="filters">
            <input type="text" id="searchTransaction" placeholder="Search transaction ID...">
            <select id="filterClass">
              <option value="">All Classes</option>
              <option value="Form 1">Form 1</option>
              <option value="Form 2">Form 2</option>
              <option value="Form 3">Form 3</option>
              <option value="Form 4">Form 4</option>
            </select>
            <select id="filterPaymentStatus">
              <option value="">All Status</option>
              <option value="completed">Completed</option>
              <option value="pending">Pending</option>
              <option value="failed">Failed</option>
            </select>
            <button onclick="exportPayments()" class="btn btn-sm">üì• Export CSV</button>
          </div>

          <div class="table-container">
            <table id="allPaymentsTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Transaction ID</th>
                  <th>Student</th>
                  <th>Class</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="allPaymentsBody">
                <tr><td colspan="8" class="text-center">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Students Management Tab -->
      <section id="tab-students" class="tab-content">
        <div class="card">
          <h3>Add New Student</h3>
          <form id="addStudentForm">
            <div class="form-row">
              <div class="form-group">
                <label for="studentName">Full Name</label>
                <input type="text" id="receiptFooter" placeholder="Thank you for your payment">
            </div>

            <h4 style="margin-top: 2rem; margin-bottom: 1rem;">Payment Breakdown Percentages</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="breakdownTuition">Tuition (%)</label>
                <input type="number" id="breakdownTuition" min="0" max="100" value="70">
              </div>
              <div class="form-group">
                <label for="breakdownFacilities">Facilities (%)</label>
                <input type="number" id="breakdownFacilities" min="0" max="100" value="15">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="breakdownActivities">Activities (%)</label>
                <input type="number" id="breakdownActivities" min="0" max="100" value="10">
              </div>
              <div class="form-group">
                <label for="breakdownOther">Other (%)</label>
                <input type="number" id="breakdownOther" min="0" max="100" value="5">
              </div>
            </div>

            <div class="breakdown-preview" style="margin: 1.5rem 0; padding: 1rem; background: var(--gray-50); border-radius: 0.5rem;">
              <strong>Total: <span id="breakdownTotal">100</span>%</strong>
              <p style="font-size: 0.875rem; color: var(--gray-700); margin-top: 0.5rem;">
                Note: Total must equal 100%
              </p>
            </div>

            <button type="submit" class="btn btn-primary">Save Receipt Configuration</button>
          </form>
        </div>

        <!-- Receipt Preview -->
        <div class="card">
          <h3>Receipt Preview</h3>
          <div id="receiptPreview" style="border: 2px solid var(--gray-300); padding: 2rem; border-radius: 0.5rem;">
            <div style="text-align: center; margin-bottom: 1.5rem;">
              <img id="previewLogo" src="" alt="School Logo" style="max-width: 150px; display: none;">
              <h2 id="previewHeader">Your School Name</h2>
              <p>Official Fee Receipt</p>
            </div>
            <hr style="margin: 1rem 0;">
            <p><strong>Receipt No:</strong> RCPT-20251105-001</p>
            <p><strong>Student:</strong> John Doe</p>
            <p><strong>Date:</strong> 05-Nov-2025</p>
            <hr style="margin: 1rem 0;">
            <h4>Payment Breakdown</h4>
            <table style="width: 100%; margin: 1rem 0;">
              <tr>
                <td>Tuition:</td>
                <td style="text-align: right;" id="previewTuition">KES 35,000</td>
              </tr>
              <tr>
                <td>Facilities:</td>
                <td style="text-align: right;" id="previewFacilities">KES 7,500</td>
              </tr>
              <tr>
                <td>Activities:</td>
                <td style="text-align: right;" id="previewActivities">KES 5,000</td>
              </tr>
              <tr>
                <td>Other:</td>
                <td style="text-align: right;" id="previewOther">KES 2,500</td>
              </tr>
              <tr style="font-weight: bold; border-top: 2px solid black;">
                <td>Total:</td>
                <td style="text-align: right;">KES 50,000</td>
              </tr>
            </table>
            <hr style="margin: 1rem 0;">
            <p style="text-align: center;" id="previewFooter">Thank you for your payment</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="js/api.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/admin.js"></script>
</body>
</html>
